<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Clinic Home · PWA</title>
<link rel="manifest" href="./manifest.json"/>
<link rel="stylesheet" href="./styles.css"/>
<style>
:root{
  --bg:linear-gradient(145deg,#f9fafb,#f7f5ff,#fff9f3);
  --card:#fff; --ink:#0f172a; --muted:#475569; --primary:#17B26A;
  --r:16px; --shadow:0 6px 18px rgba(0,0,0,.06);

  /* 30% brighter versions of v8.1 pastel shades */
  --mint:#DFFAF0;
  --lav:#F6F2FF;
  --peach:#FFF7EF;
}

/* Base */
*{box-sizing:border-box}
body{margin:0;font:14px/1.45 system-ui;background:var(--bg);color:var(--ink);min-height:100vh}
.wrap{max-width:1100px;margin:0 auto;padding:0 10px}

/* Header (locked style) */
.header{display:flex;align-items:center;justify-content:space-between;
  padding:10px 12px;background:#DED8F2b3;border-radius:12px;box-shadow:var(--shadow);margin-top:10px}
.header .logo{height:40px}
.header .title{font-weight:800;font-size:18px}
.header .sub{font-size:12px;color:var(--muted)}

/* Banner (locked style) */
.banner{position:relative;overflow:hidden;border-radius:16px;margin:12px 0;background:#D6E5DD}
.banner img{width:100%;transform:scale(.65);transform-origin:center;opacity:.95;mix-blend-mode:multiply;display:block}

/* Cards / Grid */
.card{background:var(--card);border-radius:var(--r);padding:14px;box-shadow:var(--shadow);margin-top:12px}
.grid3{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
.tile{background:#fff;border:1px solid #e2e8f0;border-radius:14px;box-shadow:var(--shadow);padding:16px;display:flex;flex-direction:column}
.tile h3{margin:0 0 6px}
.tile .desc{color:var(--muted);font-size:13px;margin-bottom:10px}
.btn{background:#fff;border:1px solid #cbd5e1;border-radius:20px;padding:8px 14px;font-weight:700;cursor:pointer;text-align:center}
.btn.primary{background:var(--primary);color:#fff;border:none}
.row{display:flex;gap:8px;flex-wrap:wrap}

/* Footer */
.footer{text-align:center;padding:14px 4px;font-size:13px;color:#64748b;margin:18px 0}
</style>
</head>
<body>
<div class="wrap">

  <!-- Header (filled from config) -->
  <div class="header">
    <div style="display:flex;align-items:center;gap:10px">
      <img class="logo" src="./assets/logo.png" alt="logo">
      <div>
        <div class="title" id="clinicName">Clinic Home</div>
        <div class="sub" id="docLine">—</div>
      </div>
    </div>
    <div class="sub" id="addrLine"></div>
  </div>

  <!-- Banner -->
  <div class="banner"><img src="./assets/banner.png" alt="Clinic Banner"></div>

  <!-- Hub tiles -->
  <div class="card" style="background:var(--mint)">
    <h3 style="margin:0 0 8px">Choose a workspace</h3>
    <div class="grid3">
      <!-- Dashboard -->
      <div class="tile" style="background:var(--lav)">
        <h3>Dashboard</h3>
        <div class="desc">KPIs · Collections · Lab income · Pharmacy sales · OPD insights</div>
        <div class="row">
          <a class="btn primary" id="goDashboard" href="./dashboard.html">Open Dashboard</a>
        </div>
      </div>

      <!-- Supervisor Hub -->
      <div class="tile" style="background:var(--peach)">
        <h3>Supervisor Hub</h3>
        <div class="desc">Access to Bookings, Booking Status (TV feed), OPD Records, Lab Hub & Pharmacy</div>
        <div class="row">
          <a class="btn primary" id="goSupervisor" href="./supervisor-hub.html">Open Supervisor Hub</a>
        </div>
      </div>

      <!-- Front Office -->
      <div class="tile" style="background:var(--lav)">
        <h3>Front Office</h3>
        <div class="desc">Bookings · Status updates · TV display control</div>
        <div class="row">
          <a class="btn primary" id="goFrontOffice" href="./frontoffice.html">Open Front Office</a>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">© 2025 <strong>Powered by Onestop AI Services</strong> · All Rights Reserved</div>
</div>

<script>
/* Full config: read /config/doctor-config.json and populate header lines */
(async function(){
  try{
    const r = await fetch('/config/doctor-config.json', {cache:'no-store'});
    const c = await r.json();
    const mkLine = x => [x.doctorName,x.degrees,x.designation,x.regNo].filter(Boolean).join(' · ');
    const addr = [c.clinicName?null:c.addressLine1, c.phone, c.timings].filter(Boolean).join(' · ');

    document.getElementById('clinicName').textContent = c.clinicName || 'Clinic Home';
    document.getElementById('docLine').textContent = mkLine(c) || '—';
    document.getElementById('addrLine').textContent = addr || '';
  }catch(e){
    // silent fallback
  }
})();

/* ==== PIN Gate (read-only here; change/reset only in settings.html) ==== */
(function(){
  const PINS = {
    dashboard: { key: 'pin_dashboard', def: '1111', target: './dashboard.html', btn: 'goDashboard' },
    supervisor:{ key: 'pin_supervisor', def: '2222', target: './supervisor-hub.html', btn: 'goSupervisor' },
    frontoffice:{ key: 'pin_frontoffice', def: '3333', target: './frontoffice.html', btn: 'goFrontOffice' }
  };

  // Ensure defaults exist (only if not already set)
  Object.values(PINS).forEach(p => {
    if (!localStorage.getItem(p.key)) localStorage.setItem(p.key, p.def);
  });

  function askPin(role){
    const saved = localStorage.getItem(PINS[role].key) || PINS[role].def;
    const pin = window.prompt(`Enter ${role.replace(/^[a-z]/,m=>m.toUpperCase())} PIN`);
    if (pin == null) return false;
    if (pin === saved) return true;
    alert('Incorrect PIN');
    return false;
  }

  Object.entries(PINS).forEach(([role, cfg])=>{
    const el = document.getElementById(cfg.btn);
    if(!el) return;
    el.addEventListener('click', (e)=>{
      e.preventDefault();                 // require PIN before navigating
      if (askPin(role)) window.location.href = cfg.target;
    });
  });
})();
</script>

<script>
/* Service worker registration */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/service-worker.js").catch(console.error);
}
</script>
</body>
</html>